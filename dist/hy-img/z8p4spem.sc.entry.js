const t=window.HyImg.h;var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,r)};function r(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function n(t){return"function"==typeof t}var i=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){i=t},get useDeprecatedSynchronousErrorHandling(){return i}};function s(t){setTimeout(function(){throw t})}var c={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;s(t)},complete:function(){}},u=Array.isArray||function(t){return t&&"number"==typeof t.length};function h(t){return null!==t&&"object"==typeof t}function a(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}a.prototype=Object.create(Error.prototype);var l=a,p=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var r=this._parent,i=this._parents,o=this._unsubscribe,s=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var c=-1,a=i?i.length:0;r;)r.remove(this),r=++c<a&&i[c]||null;if(n(o))try{o.call(this)}catch(r){e=!0,t=r instanceof l?f(r.errors):[r]}if(u(s))for(c=-1,a=s.length;++c<a;){var p=s[c];if(h(p))try{p.unsubscribe()}catch(r){e=!0,t=t||[],r instanceof l?t=t.concat(f(r.errors)):t.push(r)}}if(e)throw new l(t)}},t.prototype.add=function(e){var r=e;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:if(!e)return t.EMPTY;throw new Error("unrecognized teardown "+e+" added to Subscription.")}if(r._addParent(this)){var i=this._subscriptions;i?i.push(r):this._subscriptions=[r]}return r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.prototype._addParent=function(t){var e=this._parent,r=this._parents;return e!==t&&(e?r?-1===r.indexOf(t)&&(r.push(t),!0):(this._parents=[t],!0):(this._parent=t,!0))},t.EMPTY=((e=new t).closed=!0,e),t}();function f(t){return t.reduce(function(t,e){return t.concat(e instanceof l?e.errors:e)},[])}var b="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),d=function(t){function e(r,n,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=c;break;case 1:if(!r){o.destination=c;break}if("object"==typeof r){r instanceof e?(o.syncErrorThrowable=r.syncErrorThrowable,o.destination=r,r.add(o)):(o.syncErrorThrowable=!0,o.destination=new y(o,r));break}default:o.syncErrorThrowable=!0,o.destination=new y(o,r,n,i)}return o}return r(e,t),e.prototype[b]=function(){return this},e.create=function(t,r,n){var i=new e(t,r,n);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this},e}(p),y=function(t){function e(e,r,i,o){var s,u=t.call(this)||this;u._parentSubscriber=e;var h=u;return n(r)?s=r:r&&(s=r.next,i=r.error,o=r.complete,r!==c&&(n((h=Object.create(r)).unsubscribe)&&u.add(h.unsubscribe.bind(h)),h.unsubscribe=u.unsubscribe.bind(u))),u._context=h,u._next=s,u._error=i,u._complete=o,u}return r(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):s(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;s(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;s(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(s(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(d),v="function"==typeof Symbol&&Symbol.observable||"@@observable";function _(){}var w=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof d)return t;if(t[b])return t[b]()}return t||e||r?new d(t,e,r):new d(c)}(t,e,r);if(i.add(n?n.call(i,this.source):this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t.destination;if(t.closed||t.isStopped)return!1;t=e&&e instanceof d?e:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=g(e))(function(e,n){var i;i=r.subscribe(function(e){try{t(e)}catch(t){n(t),i&&i.unsubscribe()}},n,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[v]=function(){return this},t.prototype.pipe=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 0===e.length?this:((t=e)?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:_)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=g(t))(function(t,r){var n;e.subscribe(function(t){return n=t},function(t){return r(t)},function(){return t(n)})})},t.create=function(e){return new t(e)},t}();function g(t){if(t||(t=o.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function m(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}m.prototype=Object.create(Error.prototype);var S=m,x=function(t){function e(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(p),E=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return r(e,t),e}(d),T=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r(e,t),e.prototype[b]=function(){return new E(this)},e.prototype.lift=function(t){var e=new I(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new S;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new S;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new S;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new S;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new S;return this.hasError?(t.error(this.thrownError),p.EMPTY):this.isStopped?(t.complete(),p.EMPTY):(this.observers.push(t),new x(this,t))},e.prototype.asObservable=function(){var t=new w;return t.source=this,t},e.create=function(t,e){return new I(t,e)},e}(w),I=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return r(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):p.EMPTY},e}(T);function j(){return function(t){return t.lift(new O(t))}}var O=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var r=this.connectable;r._refCount++;var n=new C(t,r),i=e.subscribe(n);return n.closed||(n.connection=r.connect()),i},t}(),C=function(t){function e(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return r(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var r=this.connection,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null},e}(d),$=function(t){function e(e,r){var n=t.call(this)||this;return n.source=e,n.subjectFactory=r,n._refCount=0,n._isComplete=!1,n}return r(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new p).add(this.source.subscribe(new N(this.getSubject(),this))),t.closed?(this._connection=null,t=p.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return j()(this)},e}(w).prototype,A={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:$._subscribe},_isComplete:{value:$._isComplete,writable:!0},getSubject:{value:$.getSubject},connect:{value:$.connect},refCount:{value:$.refCount}},N=function(t){function e(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return r(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(E),P=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return r(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(T),R=new w(function(t){return t.complete()});function k(t){return t?function(t){return new w(function(e){return t.schedule(function(){return e.complete()})})}(t):R}function M(t){return t&&"function"==typeof t.schedule}var H=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.closed||e.complete()}};function D(t,e){return new w(e?function(r){var n=new p,i=0;return n.add(e.schedule(function(){i!==t.length?(r.next(t[i++]),r.closed||n.add(this.schedule())):r.complete()})),n}:H(t))}function U(t){var e=new w(function(e){e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}function V(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[t.length-1];switch(M(r)?t.pop():r=void 0,t.length){case 0:return k(r);case 1:return r?D(t,r):U(t[0]);default:return D(t,r)}}function W(t){return t}function Y(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new L(t,e))}}var L=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new F(t,this.project,this.thisArg))},t}(),F=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.project=r,i.count=0,i.thisArg=n||i,i}return r(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(d),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(d),B=function(t){function e(e,r,n){var i=t.call(this)||this;return i.parent=e,i.outerValue=r,i.outerIndex=n,i.index=0,i}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(d),K=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,s),e}};function q(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var G=q(),Z=function(t){return function(e){for(var r=t[G]();;){var n=r.next();if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof r.return&&e.add(function(){r.return&&r.return()}),e}},J=function(t){return function(e){var r=t[v]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(e)}},Q=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function X(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var tt=function(t){if(t instanceof w)return function(e){return t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e)};if(t&&"function"==typeof t[v])return J(t);if(Q(t))return H(t);if(X(t))return K(t);if(t&&"function"==typeof t[G])return Z(t);var e=h(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function et(t,e,r,n,i){if(void 0===i&&(i=new B(t,r,n)),!i.closed)return tt(e)(i)}var rt={};function nt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=null,n=null;return M(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0]),D(t,n).lift(new it(r))}var it=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new ot(t,this.resultSelector))},t}(),ot=function(t){function e(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return r(e,t),e.prototype._next=function(t){this.values.push(rt),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(et(this,n,n,r))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,r,n,i){var o=this.values,s=this.toRespond?o[r]===rt?--this.toRespond:this.toRespond:0;o[r]=e,0===s&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(z);function st(t,e){if(!e)return t instanceof w?t:new w(tt(t));if(null!=t){if(function(t){return t&&"function"==typeof t[v]}(t))return function(t,e){return new w(e?function(r){var n=new p;return n.add(e.schedule(function(){var i=t[v]();n.add(i.subscribe({next:function(t){n.add(e.schedule(function(){return r.next(t)}))},error:function(t){n.add(e.schedule(function(){return r.error(t)}))},complete:function(){n.add(e.schedule(function(){return r.complete()}))}}))})),n}:J(t))}(t,e);if(X(t))return function(t,e){return new w(e?function(r){var n=new p;return n.add(e.schedule(function(){return t.then(function(t){n.add(e.schedule(function(){r.next(t),n.add(e.schedule(function(){return r.complete()}))}))},function(t){n.add(e.schedule(function(){return r.error(t)}))})})),n}:K(t))}(t,e);if(Q(t))return D(t,e);if(function(t){return t&&"function"==typeof t[G]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new w(e?function(r){var n,i=new p;return i.add(function(){n&&"function"==typeof n.return&&n.return()}),i.add(e.schedule(function(){n=t[G](),i.add(e.schedule(function(){if(!r.closed){var t,e;try{var i=n.next();t=i.value,e=i.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}}))})),i}:Z(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}var ct=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new ut(t,this.project,this.concurrent))},t}(),ut=function(t){function e(e,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=r,i.concurrent=n,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,r)},e.prototype._innerSub=function(t,e,r){var n=new B(this,void 0,void 0);this.destination.add(n),et(this,t,e,r,n)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(z);function ht(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),function t(e,r,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof r?function(i){return i.pipe(t(function(t,n){return st(e(t,n)).pipe(Y(function(e,i){return r(t,e,n,i)}))},n))}:("number"==typeof r&&(n=r),function(t){return t.lift(new ct(e,n))})}(W,t)}var at=new w(_),lt=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new pt(t,this.selector,this.caught))},t}(),pt=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.selector=r,i.caught=n,i}return r(e,t),e.prototype.error=function(e){if(!this.isStopped){var r=void 0;try{r=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var n=new B(this,void 0,void 0);this.add(n),et(this,r,void 0,void 0,n)}},e}(z);function ft(t,e){return function(r){return r.lift(new bt(t,e))}}var bt=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new dt(t,this.compare,this.keySelector))},t}(),dt=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.keySelector=n,i.hasKey=!1,"function"==typeof r&&(i.compare=r),i}return r(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))},e}(d);function yt(t,e){return function(r){return r.lift(new vt(t,e))}}var vt=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new _t(t,this.predicate,this.thisArg))},t}(),_t=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.predicate=r,i.thisArg=n,i.count=0,i}return r(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(d),wt=function(){function t(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}return t.prototype.call=function(t,e){return e.subscribe(new gt(t,this.nextOrObserver,this.error,this.complete))},t}(),gt=function(t){function e(e,r,i,o){var s=t.call(this,e)||this;return s._tapNext=_,s._tapError=_,s._tapComplete=_,s._tapError=i||_,s._tapComplete=o||_,n(r)?(s._context=s,s._tapNext=r):r&&(s._context=r,s._tapNext=r.next||_,s._tapError=r.error||_,s._tapComplete=r.complete||_),s}return r(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(d);function mt(){return new T}function St(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var r=t[t.length-1];M(r)?t.pop():r=null;var n=t.length;return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ht(1)(V.apply(void 0,t))}(1!==n||r?n>0?D(t,r):k(r):U(t[0]),e)}}function xt(t,e){return"function"==typeof e?function(r){return r.pipe(xt(function(r,n){return st(t(r,n)).pipe(Y(function(t,i){return e(r,t,n,i)}))}))}:function(e){return e.lift(new Et(t))}}var Et=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Tt(t,this.project))},t}(),Tt=function(t){function e(e,r){var n=t.call(this,e)||this;return n.project=r,n.index=0,n}return r(e,t),e.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,r)},e.prototype._innerSub=function(t,e,r){var n=this.innerSubscription;n&&n.unsubscribe();var i=new B(this,void 0,void 0);this.destination.add(i),this.innerSubscription=et(this,t,e,r,i)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},e}(z);function It({protocol:t,host:e},r=window.location){return t!==r.protocol||e!==r.host}const jt=(t,...e)=>t,Ot=/(\S+)(?:\s+(?:(-?\d+(?:\.\d+)?)([a-zA-Z]*)))?\s*(?:,|$)/g;class Ct{constructor(t){jt(t.length>0,"Srcset must have at least one source"),this.sources_=t;let e=!1,r=!1;for(let n=0;n<t.length;n++){const i=t[n];e=e||!!i.width,r=r||!!i.dpr}t.sort(e?$t:At),this.widthBased_=e}select(t,e){let r=0;return r=this.widthBased_?this.selectByWidth_(t*e):this.selectByDpr_(e),this.sources_[r].url}selectByWidth_(t){const e=this.sources_;let r=0,n=1/0,i=1/0;for(let o=0;o<e.length;o++){const s=e[o].width,c=Math.abs(s-t);if(!(c<=1.1*n||t/i>1.2))break;r=o,n=c,i=s}return r}selectByDpr_(t){const e=this.sources_;let r=0,n=1/0;for(let i=0;i<e.length;i++){const o=Math.abs(e[i].dpr-t);if(!(o<=n))break;r=i,n=o}return r}getUrls(){return this.sources_.map(t=>t.url)}stringify(t){const e=[],r=this.sources_;for(let n=0;n<r.length;n++){const i=r[n];let o=i.url;t&&(o=t(o)),e.push(o+=this.widthBased_?` ${i.width}w`:` ${i.dpr}x`)}return e.join(", ")}}function $t(t,e){return jt(t.width!=e.width,"Duplicate width: %s",t.width),t.width-e.width}function At(t,e){return jt(t.dpr!=e.dpr,"Duplicate dpr: %s",t.dpr),t.dpr-e.dpr}class Nt{constructor(){this.w=0,this.h=0,this.strategy="cache",this.loadImage$=new T,this.cache=new Map,this.url=null,this.visibility="hidden"}setRoot(t){this.root$.next(t)}setRootMargin(t){this.rootMargin$.next(t)}setW(t){this.w$.next(t)}setH(t){this.h$.next(t)}setSrc(t){this.src$.next(t)}setSrcset(t){this.srcset$.next(t)}getIsIntersecting(){return nt(this.root$,this.rootMargin$).pipe(xt(([t,e])=>"IntersectionObserver"in window?function(t,e){return w.create(r=>{const n=new IntersectionObserver(t=>t.forEach(t=>r.next(t)),e);return n.observe(t),()=>{n.unobserve(t)}})}(this.el,{root:document.querySelector(t),rootMargin:e}):V({isIntersecting:!0})),Y(({isIntersecting:t})=>t))}getContentWidth(){return"ResizeObserver"in window?(t=this.el,w.create(e=>{const r=new window.ResizeObserver(t=>t.forEach(t=>e.next(t)));return r.observe(t),()=>{r.unobserve(t)}})).pipe(Y(t=>t.contentRect.width),St(this.el.clientWidth)):at;var t}componentWillLoad(){this.connected$=new P(!0),this.root$=new P(this.root),this.rootMargin$=new P(this.rootMargin),this.w$=new P(this.w),this.h$=new P(this.h),this.src$=new P(this.src),this.srcset$=new P(this.srcset);const t=this.getContentWidth();nt(t,this.w$,this.h$).subscribe(([t,e,r])=>{this.contentWidth=t,this.renderWidth=e,this.renderHeight=r});const e=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Number.POSITIVE_INFINITY,n=null,i=t[t.length-1];return M(i)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof i&&(r=t.pop()),null===n&&1===t.length&&t[0]instanceof w?t[0]:ht(r)(D(t,n))}(this.getIsIntersecting(),this.loadImage$).pipe(function(t){return j()((e=mt,function(t){var r;r="function"==typeof e?e:function(){return e};var n=Object.create(t,A);return n.source=t,n.subjectFactory=r,n})(t));var e});e.pipe(yt(t=>!!t),ft()).subscribe(()=>this.triggered(e,t))}triggered(t,e){const r=nt(this.src$,this.srcset$).pipe(yt(([t,e])=>null!=t||null!=e),ft(([t,e],[r,n])=>t===r&&e===n),Y(([t,e])=>e?function(t){const e=[];let r;for(;r=Ot.exec(t);){const t=r[1];let n,i;if(r[2]){const t=r[3].toLowerCase();if("w"==t)n=parseInt(r[2],10);else{if("x"!=t)continue;i=parseFloat(r[2])}}else i=1;e.push({url:t,width:n,dpr:i})}return new Ct(e)}(e):function(t){return new Ct([{url:t,width:void 0,dpr:1}])}(t))),n=nt(e,r).pipe(Y(t=>this.selectSrcsetURL(...t)),("href",ft(function(t,e){return t.href===e.href})));const i=t.pipe(St(!0));var o;nt(n,i).pipe(xt(t=>this.fetchImage(...t)),(o=(()=>n),function(t){var e=new lt(o),r=t.lift(e);return e.caught=r})).subscribe(t=>{this.url=t})}selectSrcsetURL(t,e){const r=window.devicePixelRatio||1,n=e.select(t||window.screen.width,r);return new URL(n,window.location.href)}cacheStrategy(t){switch(this.strategy){case"blob":return t.pipe(xt(t=>t.blob()),Y(t=>URL.createObjectURL(t)));case"cache":default:return t.pipe(Y(t=>t.url))}}fetchImage(t,e){const{href:r}=t,{cache:n}=this;if(e&&!n.has(r)){const e=(o=r,s={method:"GET",headers:{Accept:"image/*"},mode:It(t)?"cors":void 0},w.create(t=>{const e=new AbortController,{signal:r}=e;let n=null;return fetch(o,Object.assign({},s,{signal:r})).then(e=>{n=e,t.next(e),t.complete()}).catch(e=>t.error(e)),()=>{n||e.abort()}}));return this.cacheStrategy(e).pipe((i=(t=>n.set(r,t)),function(t){return t.lift(new wt(i,void 0,void 0))}))}return n.has(r)?V(n.get(r)):at;var i,o,s}render(){return[t("div",{class:"sizer",style:this.calcSizerStyle()},t("slot",{name:"loading"}),this.url?t("img",{src:this.url,style:this.calcImageStyle(),alt:this.alt,decoding:this.decoding,useMap:this.useMap,onLoad:()=>this.visibility="visible"}):null)]}calcImageStyle(){return{visibility:this.visibility}}calcSizerStyle(){const{renderWidth:t,renderHeight:e,contentWidth:r}=this,n={};return 0!==t&&0!==e?t>=r?(n.width="100%",n.paddingTop=`${e/t*100}%`):(n.width=`${t}px`,n.height=`${e}px`):0!==e?(n.width="",n.height=`${e}px`):(n.width="",n.height=""),n}componentDidUnload(){this.connected$.next(!1),this.cache&&this.cache.forEach(t=>{URL.revokeObjectURL(t)})}loadImage(){this.loadImage$.next(!0)}static get is(){return"hy-img"}static get encapsulation(){return"shadow"}static get properties(){return{alt:{type:String,attr:"alt",reflectToAttr:!0,mutable:!0},contentWidth:{state:!0},decoding:{type:String,attr:"decoding",reflectToAttr:!0,mutable:!0},el:{elementRef:!0},h:{type:Number,attr:"h",reflectToAttr:!0,mutable:!0,watchCallbacks:["setH"]},loadImage:{method:!0},renderHeight:{state:!0},renderWidth:{state:!0},root:{type:String,attr:"root",reflectToAttr:!0,mutable:!0,watchCallbacks:["setRoot"]},rootMargin:{type:String,attr:"root-margin",reflectToAttr:!0,mutable:!0,watchCallbacks:["setRootMargin"]},src:{type:String,attr:"src",reflectToAttr:!0,mutable:!0,watchCallbacks:["setSrc"]},srcset:{type:String,attr:"srcset",reflectToAttr:!0,mutable:!0,watchCallbacks:["setSrcset"]},strategy:{type:String,attr:"strategy",reflectToAttr:!0,mutable:!0},url:{state:!0},useMap:{type:String,attr:"usemap",reflectToAttr:!0,mutable:!0},visibility:{state:!0},w:{type:Number,attr:"w",reflectToAttr:!0,mutable:!0,watchCallbacks:["setW"]}}}static get style(){return".sizer.sc-hy-img{position:relative}img.sc-hy-img{position:absolute;top:0;left:0;max-width:100%;max-height:100%}"}}export{Nt as HyImg};